#include <stdint.h>
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "config.h"

#include "Tentusscher2004McellNetwork/tentusscher_2004_mcell.h"

Tentusscher2004Mcell tentusscher_2004_mcell_data;

int main(void) {
    Tentusscher2004McellInit(&tentusscher_2004_mcell_data);

#if ENABLE_LOGGING
    FILE* fp = fopen(LOGGING_FILE, "w");
    fprintf(fp, "Time,tentusscher_2004_mcell.environment_time,tentusscher_2004_mcell.membrane_V,tentusscher_2004_mcell.membrane_R,tentusscher_2004_mcell.membrane_T,tentusscher_2004_mcell.membrane_F,tentusscher_2004_mcell.membrane_Cm,tentusscher_2004_mcell.membrane_V_c,tentusscher_2004_mcell.membrane_i_Stim,tentusscher_2004_mcell.reversal_potentials_E_Na,tentusscher_2004_mcell.reversal_potentials_E_K,tentusscher_2004_mcell.reversal_potentials_E_Ks,tentusscher_2004_mcell.reversal_potentials_E_Ca,tentusscher_2004_mcell.inward_rectifier_potassium_current_i_K1,tentusscher_2004_mcell.rapid_time_dependent_potassium_current_i_Kr,tentusscher_2004_mcell.rapid_time_dependent_potassium_current_time_private,tentusscher_2004_mcell.rapid_time_dependent_potassium_current_V_private,tentusscher_2004_mcell.rapid_time_dependent_potassium_current_Xr1_gate_Xr1,tentusscher_2004_mcell.rapid_time_dependent_potassium_current_Xr2_gate_Xr2,tentusscher_2004_mcell.slow_time_dependent_potassium_current_i_Ks,tentusscher_2004_mcell.slow_time_dependent_potassium_current_time_private,tentusscher_2004_mcell.slow_time_dependent_potassium_current_V_private,tentusscher_2004_mcell.slow_time_dependent_potassium_current_Xs_gate_Xs,tentusscher_2004_mcell.fast_sodium_current_i_Na,tentusscher_2004_mcell.fast_sodium_current_time_private,tentusscher_2004_mcell.fast_sodium_current_V_private,tentusscher_2004_mcell.fast_sodium_current_m_gate_m,tentusscher_2004_mcell.fast_sodium_current_h_gate_h,tentusscher_2004_mcell.fast_sodium_current_j_gate_j,tentusscher_2004_mcell.sodium_background_current_i_b_Na,tentusscher_2004_mcell.L_type_Ca_current_i_CaL,tentusscher_2004_mcell.L_type_Ca_current_Ca_i_private,tentusscher_2004_mcell.L_type_Ca_current_time_private,tentusscher_2004_mcell.L_type_Ca_current_V_private,tentusscher_2004_mcell.L_type_Ca_current_d,tentusscher_2004_mcell.L_type_Ca_current_d_gate_d,tentusscher_2004_mcell.L_type_Ca_current_f_gate_f,tentusscher_2004_mcell.L_type_Ca_current_fCa_gate_fCa,tentusscher_2004_mcell.calcium_background_current_i_b_Ca,tentusscher_2004_mcell.transient_outward_current_i_to,tentusscher_2004_mcell.transient_outward_current_V_private,tentusscher_2004_mcell.transient_outward_current_time_private,tentusscher_2004_mcell.transient_outward_current_s_gate_s,tentusscher_2004_mcell.transient_outward_current_r_gate_r,tentusscher_2004_mcell.sodium_potassium_pump_current_i_NaK,tentusscher_2004_mcell.sodium_potassium_pump_current_V_private,tentusscher_2004_mcell.sodium_calcium_exchanger_current_i_NaCa,tentusscher_2004_mcell.calcium_pump_current_i_p_Ca,tentusscher_2004_mcell.potassium_pump_current_i_p_K,tentusscher_2004_mcell.calcium_dynamics_Ca_i,tentusscher_2004_mcell.calcium_dynamics_Ca_o,tentusscher_2004_mcell.sodium_dynamics_Na_i,tentusscher_2004_mcell.sodium_dynamics_Na_o,tentusscher_2004_mcell.potassium_dynamics_K_i,tentusscher_2004_mcell.potassium_dynamics_K_o\n");
    fprintf(fp, "%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f\n", 0.0, tentusscher_2004_mcell_data.environment_time, tentusscher_2004_mcell_data.membrane_v, tentusscher_2004_mcell_data.membrane_r, tentusscher_2004_mcell_data.membrane_t, tentusscher_2004_mcell_data.membrane_f, tentusscher_2004_mcell_data.membrane_cm, tentusscher_2004_mcell_data.membrane_v_c, tentusscher_2004_mcell_data.membrane_i_stim, tentusscher_2004_mcell_data.reversal_potentials_e_na, tentusscher_2004_mcell_data.reversal_potentials_e_k, tentusscher_2004_mcell_data.reversal_potentials_e_ks, tentusscher_2004_mcell_data.reversal_potentials_e_ca, tentusscher_2004_mcell_data.inward_rectifier_potassium_current_i_k1, tentusscher_2004_mcell_data.rapid_time_dependent_potassium_current_i_kr, tentusscher_2004_mcell_data.rapid_time_dependent_potassium_current_time_private, tentusscher_2004_mcell_data.rapid_time_dependent_potassium_current_v_private, tentusscher_2004_mcell_data.rapid_time_dependent_potassium_current_xr1_gate_xr1, tentusscher_2004_mcell_data.rapid_time_dependent_potassium_current_xr2_gate_xr2, tentusscher_2004_mcell_data.slow_time_dependent_potassium_current_i_ks, tentusscher_2004_mcell_data.slow_time_dependent_potassium_current_time_private, tentusscher_2004_mcell_data.slow_time_dependent_potassium_current_v_private, tentusscher_2004_mcell_data.slow_time_dependent_potassium_current_xs_gate_xs, tentusscher_2004_mcell_data.fast_sodium_current_i_na, tentusscher_2004_mcell_data.fast_sodium_current_time_private, tentusscher_2004_mcell_data.fast_sodium_current_v_private, tentusscher_2004_mcell_data.fast_sodium_current_m_gate_m, tentusscher_2004_mcell_data.fast_sodium_current_h_gate_h, tentusscher_2004_mcell_data.fast_sodium_current_j_gate_j, tentusscher_2004_mcell_data.sodium_background_current_i_b_na, tentusscher_2004_mcell_data.l_type_ca_current_i_cal, tentusscher_2004_mcell_data.l_type_ca_current_ca_i_private, tentusscher_2004_mcell_data.l_type_ca_current_time_private, tentusscher_2004_mcell_data.l_type_ca_current_v_private, tentusscher_2004_mcell_data.l_type_ca_current_d, tentusscher_2004_mcell_data.l_type_ca_current_d_gate_d, tentusscher_2004_mcell_data.l_type_ca_current_f_gate_f, tentusscher_2004_mcell_data.l_type_ca_current_fca_gate_fca, tentusscher_2004_mcell_data.calcium_background_current_i_b_ca, tentusscher_2004_mcell_data.transient_outward_current_i_to, tentusscher_2004_mcell_data.transient_outward_current_v_private, tentusscher_2004_mcell_data.transient_outward_current_time_private, tentusscher_2004_mcell_data.transient_outward_current_s_gate_s, tentusscher_2004_mcell_data.transient_outward_current_r_gate_r, tentusscher_2004_mcell_data.sodium_potassium_pump_current_i_nak, tentusscher_2004_mcell_data.sodium_potassium_pump_current_v_private, tentusscher_2004_mcell_data.sodium_calcium_exchanger_current_i_naca, tentusscher_2004_mcell_data.calcium_pump_current_i_p_ca, tentusscher_2004_mcell_data.potassium_pump_current_i_p_k, tentusscher_2004_mcell_data.calcium_dynamics_ca_i, tentusscher_2004_mcell_data.calcium_dynamics_ca_o, tentusscher_2004_mcell_data.sodium_dynamics_na_i, tentusscher_2004_mcell_data.sodium_dynamics_na_o, tentusscher_2004_mcell_data.potassium_dynamics_k_i, tentusscher_2004_mcell_data.potassium_dynamics_k_o);
    unsigned int last_log = 0;
#endif

    unsigned int i = 0;
    for(i=1; i <= (SIMULATION_TIME / STEP_SIZE); i++) {
        Tentusscher2004McellRun(&tentusscher_2004_mcell_data);

        /* Logging */
#if ENABLE_LOGGING
        if((i - last_log) >= LOGGING_INTERVAL / STEP_SIZE) {
            fprintf(fp, "%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f\n", i*STEP_SIZE, tentusscher_2004_mcell_data.environment_time, tentusscher_2004_mcell_data.membrane_v, tentusscher_2004_mcell_data.membrane_r, tentusscher_2004_mcell_data.membrane_t, tentusscher_2004_mcell_data.membrane_f, tentusscher_2004_mcell_data.membrane_cm, tentusscher_2004_mcell_data.membrane_v_c, tentusscher_2004_mcell_data.membrane_i_stim, tentusscher_2004_mcell_data.reversal_potentials_e_na, tentusscher_2004_mcell_data.reversal_potentials_e_k, tentusscher_2004_mcell_data.reversal_potentials_e_ks, tentusscher_2004_mcell_data.reversal_potentials_e_ca, tentusscher_2004_mcell_data.inward_rectifier_potassium_current_i_k1, tentusscher_2004_mcell_data.rapid_time_dependent_potassium_current_i_kr, tentusscher_2004_mcell_data.rapid_time_dependent_potassium_current_time_private, tentusscher_2004_mcell_data.rapid_time_dependent_potassium_current_v_private, tentusscher_2004_mcell_data.rapid_time_dependent_potassium_current_xr1_gate_xr1, tentusscher_2004_mcell_data.rapid_time_dependent_potassium_current_xr2_gate_xr2, tentusscher_2004_mcell_data.slow_time_dependent_potassium_current_i_ks, tentusscher_2004_mcell_data.slow_time_dependent_potassium_current_time_private, tentusscher_2004_mcell_data.slow_time_dependent_potassium_current_v_private, tentusscher_2004_mcell_data.slow_time_dependent_potassium_current_xs_gate_xs, tentusscher_2004_mcell_data.fast_sodium_current_i_na, tentusscher_2004_mcell_data.fast_sodium_current_time_private, tentusscher_2004_mcell_data.fast_sodium_current_v_private, tentusscher_2004_mcell_data.fast_sodium_current_m_gate_m, tentusscher_2004_mcell_data.fast_sodium_current_h_gate_h, tentusscher_2004_mcell_data.fast_sodium_current_j_gate_j, tentusscher_2004_mcell_data.sodium_background_current_i_b_na, tentusscher_2004_mcell_data.l_type_ca_current_i_cal, tentusscher_2004_mcell_data.l_type_ca_current_ca_i_private, tentusscher_2004_mcell_data.l_type_ca_current_time_private, tentusscher_2004_mcell_data.l_type_ca_current_v_private, tentusscher_2004_mcell_data.l_type_ca_current_d, tentusscher_2004_mcell_data.l_type_ca_current_d_gate_d, tentusscher_2004_mcell_data.l_type_ca_current_f_gate_f, tentusscher_2004_mcell_data.l_type_ca_current_fca_gate_fca, tentusscher_2004_mcell_data.calcium_background_current_i_b_ca, tentusscher_2004_mcell_data.transient_outward_current_i_to, tentusscher_2004_mcell_data.transient_outward_current_v_private, tentusscher_2004_mcell_data.transient_outward_current_time_private, tentusscher_2004_mcell_data.transient_outward_current_s_gate_s, tentusscher_2004_mcell_data.transient_outward_current_r_gate_r, tentusscher_2004_mcell_data.sodium_potassium_pump_current_i_nak, tentusscher_2004_mcell_data.sodium_potassium_pump_current_v_private, tentusscher_2004_mcell_data.sodium_calcium_exchanger_current_i_naca, tentusscher_2004_mcell_data.calcium_pump_current_i_p_ca, tentusscher_2004_mcell_data.potassium_pump_current_i_p_k, tentusscher_2004_mcell_data.calcium_dynamics_ca_i, tentusscher_2004_mcell_data.calcium_dynamics_ca_o, tentusscher_2004_mcell_data.sodium_dynamics_na_i, tentusscher_2004_mcell_data.sodium_dynamics_na_o, tentusscher_2004_mcell_data.potassium_dynamics_k_i, tentusscher_2004_mcell_data.potassium_dynamics_k_o);
            last_log = i;
        }
#endif
    }

    return 0;
}
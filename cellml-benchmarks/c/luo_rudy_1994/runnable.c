#include <stdint.h>
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "config.h"

#include "LuoRudy1994Network/luo_rudy_1994.h"

LuoRudy1994 luo_rudy_1994_data;

int main(void) {
    LuoRudy1994Init(&luo_rudy_1994_data);

#if ENABLE_LOGGING
    FILE* fp = fopen(LOGGING_FILE, "w");
    fprintf(fp, "Time,luo_rudy_1994.environment_time,luo_rudy_1994.membrane_V,luo_rudy_1994.membrane_R,luo_rudy_1994.membrane_T,luo_rudy_1994.membrane_F,luo_rudy_1994.membrane_dV_dt,luo_rudy_1994.membrane_IStimC,luo_rudy_1994.fast_sodium_current_i_Na,luo_rudy_1994.fast_sodium_current_E_Na,luo_rudy_1994.fast_sodium_current_time_private,luo_rudy_1994.fast_sodium_current_V_private,luo_rudy_1994.fast_sodium_current_m_gate_m,luo_rudy_1994.fast_sodium_current_h_gate_h,luo_rudy_1994.fast_sodium_current_j_gate_j,luo_rudy_1994.L_type_Ca_channel_i_Ca_L,luo_rudy_1994.L_type_Ca_channel_i_CaCa,luo_rudy_1994.L_type_Ca_channel_i_CaK,luo_rudy_1994.L_type_Ca_channel_i_CaNa,luo_rudy_1994.L_type_Ca_channel_gamma_Nai,luo_rudy_1994.L_type_Ca_channel_gamma_Nao,luo_rudy_1994.L_type_Ca_channel_gamma_Ki,luo_rudy_1994.L_type_Ca_channel_gamma_Ko,luo_rudy_1994.L_type_Ca_channel_time_private,luo_rudy_1994.L_type_Ca_channel_V_private,luo_rudy_1994.L_type_Ca_channel_Cai_private,luo_rudy_1994.L_type_Ca_channel_d_gate_d,luo_rudy_1994.L_type_Ca_channel_f_gate_f,luo_rudy_1994.L_type_Ca_channel_f_Ca_gate_f_Ca,luo_rudy_1994.time_dependent_potassium_current_i_K,luo_rudy_1994.time_dependent_potassium_current_time_private,luo_rudy_1994.time_dependent_potassium_current_V_private,luo_rudy_1994.time_dependent_potassium_current_X_gate_X,luo_rudy_1994.time_dependent_potassium_current_Xi_gate_Xi,luo_rudy_1994.time_independent_potassium_current_i_K1,luo_rudy_1994.time_independent_potassium_current_E_K1,luo_rudy_1994.time_independent_potassium_current_time_private,luo_rudy_1994.time_independent_potassium_current_V_private,luo_rudy_1994.time_independent_potassium_current_K1_gate_K1_infinity,luo_rudy_1994.plateau_potassium_current_i_Kp,luo_rudy_1994.sarcolemmal_calcium_pump_i_p_Ca,luo_rudy_1994.sodium_background_current_i_Na_b,luo_rudy_1994.calcium_background_current_i_Ca_b,luo_rudy_1994.sodium_potassium_pump_i_NaK,luo_rudy_1994.non_specific_calcium_activated_current_i_ns_Ca,luo_rudy_1994.non_specific_calcium_activated_current_i_ns_Na,luo_rudy_1994.non_specific_calcium_activated_current_i_ns_K,luo_rudy_1994.Na_Ca_exchanger_i_NaCa,luo_rudy_1994.calcium_fluxes_in_the_SR_i_rel,luo_rudy_1994.calcium_fluxes_in_the_SR_i_up,luo_rudy_1994.calcium_fluxes_in_the_SR_i_leak,luo_rudy_1994.calcium_fluxes_in_the_SR_i_tr,luo_rudy_1994.ionic_concentrations_Nai,luo_rudy_1994.ionic_concentrations_Nao,luo_rudy_1994.ionic_concentrations_Cai,luo_rudy_1994.ionic_concentrations_Cao,luo_rudy_1994.ionic_concentrations_Ki,luo_rudy_1994.ionic_concentrations_Ko,luo_rudy_1994.ionic_concentrations_Ca_JSR,luo_rudy_1994.ionic_concentrations_Ca_NSR\n");
    fprintf(fp, "%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f\n", 0.0, luo_rudy_1994_data.environment_time, luo_rudy_1994_data.membrane_v, luo_rudy_1994_data.membrane_r, luo_rudy_1994_data.membrane_t, luo_rudy_1994_data.membrane_f, luo_rudy_1994_data.membrane_dv_dt, luo_rudy_1994_data.membrane_istimc, luo_rudy_1994_data.fast_sodium_current_i_na, luo_rudy_1994_data.fast_sodium_current_e_na, luo_rudy_1994_data.fast_sodium_current_time_private, luo_rudy_1994_data.fast_sodium_current_v_private, luo_rudy_1994_data.fast_sodium_current_m_gate_m, luo_rudy_1994_data.fast_sodium_current_h_gate_h, luo_rudy_1994_data.fast_sodium_current_j_gate_j, luo_rudy_1994_data.l_type_ca_channel_i_ca_l, luo_rudy_1994_data.l_type_ca_channel_i_caca, luo_rudy_1994_data.l_type_ca_channel_i_cak, luo_rudy_1994_data.l_type_ca_channel_i_cana, luo_rudy_1994_data.l_type_ca_channel_gamma_nai, luo_rudy_1994_data.l_type_ca_channel_gamma_nao, luo_rudy_1994_data.l_type_ca_channel_gamma_ki, luo_rudy_1994_data.l_type_ca_channel_gamma_ko, luo_rudy_1994_data.l_type_ca_channel_time_private, luo_rudy_1994_data.l_type_ca_channel_v_private, luo_rudy_1994_data.l_type_ca_channel_cai_private, luo_rudy_1994_data.l_type_ca_channel_d_gate_d, luo_rudy_1994_data.l_type_ca_channel_f_gate_f, luo_rudy_1994_data.l_type_ca_channel_f_ca_gate_f_ca, luo_rudy_1994_data.time_dependent_potassium_current_i_k, luo_rudy_1994_data.time_dependent_potassium_current_time_private, luo_rudy_1994_data.time_dependent_potassium_current_v_private, luo_rudy_1994_data.time_dependent_potassium_current_x_gate_x, luo_rudy_1994_data.time_dependent_potassium_current_xi_gate_xi, luo_rudy_1994_data.time_independent_potassium_current_i_k1, luo_rudy_1994_data.time_independent_potassium_current_e_k1, luo_rudy_1994_data.time_independent_potassium_current_time_private, luo_rudy_1994_data.time_independent_potassium_current_v_private, luo_rudy_1994_data.time_independent_potassium_current_k1_gate_k1_infinity, luo_rudy_1994_data.plateau_potassium_current_i_kp, luo_rudy_1994_data.sarcolemmal_calcium_pump_i_p_ca, luo_rudy_1994_data.sodium_background_current_i_na_b, luo_rudy_1994_data.calcium_background_current_i_ca_b, luo_rudy_1994_data.sodium_potassium_pump_i_nak, luo_rudy_1994_data.non_specific_calcium_activated_current_i_ns_ca, luo_rudy_1994_data.non_specific_calcium_activated_current_i_ns_na, luo_rudy_1994_data.non_specific_calcium_activated_current_i_ns_k, luo_rudy_1994_data.na_ca_exchanger_i_naca, luo_rudy_1994_data.calcium_fluxes_in_the_sr_i_rel, luo_rudy_1994_data.calcium_fluxes_in_the_sr_i_up, luo_rudy_1994_data.calcium_fluxes_in_the_sr_i_leak, luo_rudy_1994_data.calcium_fluxes_in_the_sr_i_tr, luo_rudy_1994_data.ionic_concentrations_nai, luo_rudy_1994_data.ionic_concentrations_nao, luo_rudy_1994_data.ionic_concentrations_cai, luo_rudy_1994_data.ionic_concentrations_cao, luo_rudy_1994_data.ionic_concentrations_ki, luo_rudy_1994_data.ionic_concentrations_ko, luo_rudy_1994_data.ionic_concentrations_ca_jsr, luo_rudy_1994_data.ionic_concentrations_ca_nsr);
    unsigned int last_log = 0;
#endif

    unsigned int i = 0;
    for(i=1; i <= (SIMULATION_TIME / STEP_SIZE); i++) {
        LuoRudy1994Run(&luo_rudy_1994_data);

        /* Logging */
#if ENABLE_LOGGING
        if((i - last_log) >= LOGGING_INTERVAL / STEP_SIZE) {
            fprintf(fp, "%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f,%f\n", i*STEP_SIZE, luo_rudy_1994_data.environment_time, luo_rudy_1994_data.membrane_v, luo_rudy_1994_data.membrane_r, luo_rudy_1994_data.membrane_t, luo_rudy_1994_data.membrane_f, luo_rudy_1994_data.membrane_dv_dt, luo_rudy_1994_data.membrane_istimc, luo_rudy_1994_data.fast_sodium_current_i_na, luo_rudy_1994_data.fast_sodium_current_e_na, luo_rudy_1994_data.fast_sodium_current_time_private, luo_rudy_1994_data.fast_sodium_current_v_private, luo_rudy_1994_data.fast_sodium_current_m_gate_m, luo_rudy_1994_data.fast_sodium_current_h_gate_h, luo_rudy_1994_data.fast_sodium_current_j_gate_j, luo_rudy_1994_data.l_type_ca_channel_i_ca_l, luo_rudy_1994_data.l_type_ca_channel_i_caca, luo_rudy_1994_data.l_type_ca_channel_i_cak, luo_rudy_1994_data.l_type_ca_channel_i_cana, luo_rudy_1994_data.l_type_ca_channel_gamma_nai, luo_rudy_1994_data.l_type_ca_channel_gamma_nao, luo_rudy_1994_data.l_type_ca_channel_gamma_ki, luo_rudy_1994_data.l_type_ca_channel_gamma_ko, luo_rudy_1994_data.l_type_ca_channel_time_private, luo_rudy_1994_data.l_type_ca_channel_v_private, luo_rudy_1994_data.l_type_ca_channel_cai_private, luo_rudy_1994_data.l_type_ca_channel_d_gate_d, luo_rudy_1994_data.l_type_ca_channel_f_gate_f, luo_rudy_1994_data.l_type_ca_channel_f_ca_gate_f_ca, luo_rudy_1994_data.time_dependent_potassium_current_i_k, luo_rudy_1994_data.time_dependent_potassium_current_time_private, luo_rudy_1994_data.time_dependent_potassium_current_v_private, luo_rudy_1994_data.time_dependent_potassium_current_x_gate_x, luo_rudy_1994_data.time_dependent_potassium_current_xi_gate_xi, luo_rudy_1994_data.time_independent_potassium_current_i_k1, luo_rudy_1994_data.time_independent_potassium_current_e_k1, luo_rudy_1994_data.time_independent_potassium_current_time_private, luo_rudy_1994_data.time_independent_potassium_current_v_private, luo_rudy_1994_data.time_independent_potassium_current_k1_gate_k1_infinity, luo_rudy_1994_data.plateau_potassium_current_i_kp, luo_rudy_1994_data.sarcolemmal_calcium_pump_i_p_ca, luo_rudy_1994_data.sodium_background_current_i_na_b, luo_rudy_1994_data.calcium_background_current_i_ca_b, luo_rudy_1994_data.sodium_potassium_pump_i_nak, luo_rudy_1994_data.non_specific_calcium_activated_current_i_ns_ca, luo_rudy_1994_data.non_specific_calcium_activated_current_i_ns_na, luo_rudy_1994_data.non_specific_calcium_activated_current_i_ns_k, luo_rudy_1994_data.na_ca_exchanger_i_naca, luo_rudy_1994_data.calcium_fluxes_in_the_sr_i_rel, luo_rudy_1994_data.calcium_fluxes_in_the_sr_i_up, luo_rudy_1994_data.calcium_fluxes_in_the_sr_i_leak, luo_rudy_1994_data.calcium_fluxes_in_the_sr_i_tr, luo_rudy_1994_data.ionic_concentrations_nai, luo_rudy_1994_data.ionic_concentrations_nao, luo_rudy_1994_data.ionic_concentrations_cai, luo_rudy_1994_data.ionic_concentrations_cao, luo_rudy_1994_data.ionic_concentrations_ki, luo_rudy_1994_data.ionic_concentrations_ko, luo_rudy_1994_data.ionic_concentrations_ca_jsr, luo_rudy_1994_data.ionic_concentrations_ca_nsr);
            last_log = i;
        }
#endif
    }

    return 0;
}